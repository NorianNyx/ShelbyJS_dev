{"filter":false,"title":"user.js","tooltip":"/models/shelby/user.js","undoManager":{"mark":92,"position":92,"stack":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":32},"end":{"row":22,"column":33}},"text":"y"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":31},"end":{"row":22,"column":32}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":30},"end":{"row":22,"column":31}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":29},"end":{"row":22,"column":30}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":28},"end":{"row":22,"column":29}},"text":"A"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":28},"end":{"row":22,"column":30}},"text":"[]"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":29},"end":{"row":22,"column":30}},"text":"N"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":30},"end":{"row":22,"column":31}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":31},"end":{"row":22,"column":32}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":32},"end":{"row":22,"column":33}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":33},"end":{"row":22,"column":34}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":34},"end":{"row":22,"column":35}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":35},"end":{"row":22,"column":36}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":34},"end":{"row":22,"column":35}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":33},"end":{"row":22,"column":34}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":32},"end":{"row":22,"column":33}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":31},"end":{"row":22,"column":32}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":30},"end":{"row":22,"column":31}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":29},"end":{"row":22,"column":30}},"text":"N"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":28},"end":{"row":22,"column":29}},"text":"["}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":28},"end":{"row":22,"column":29}},"text":"A"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":29},"end":{"row":22,"column":30}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":30},"end":{"row":22,"column":31}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":31},"end":{"row":22,"column":32}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":32},"end":{"row":22,"column":33}},"text":"y"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":28},"end":{"row":22,"column":33}},"text":"Array"},{"action":"insertText","range":{"start":{"row":22,"column":28},"end":{"row":22,"column":29}},"text":"["}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":29},"end":{"row":22,"column":30}},"text":"N"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":30},"end":{"row":22,"column":31}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":31},"end":{"row":22,"column":32}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":32},"end":{"row":22,"column":33}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":33},"end":{"row":22,"column":34}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":34},"end":{"row":22,"column":35}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":35},"end":{"row":22,"column":36}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":35},"end":{"row":22,"column":36}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":35},"end":{"row":22,"column":36}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":0},"end":{"row":42,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":42,"column":0}},"nl":"\n","lines":["","userSchema.statics.getByUsername = function (username, callback) {","    this.findOne({ 'Local.Username' : username }, function (err, user) {","        if (err) {","            return callback(err);","        } else {","            return callback(null, user);","        }","    })"]},{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":0},"end":{"row":42,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":42,"column":0}},"nl":"\n","lines":["","userSchema.statics.getByID = function (id, callback) {","    this.findOne({ 'UserID' : id }, function (err, user) {","        if (err) {","            return callback(err);","        } else {","            return callback(null, user);","        }","    })"]},{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":0},"end":{"row":42,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":42,"column":0}},"nl":"\n","lines":["","userSchema.statics.getAllUsers = function (callback) {","    this.find({}, function (err, users) {","        if (err) {","            return callback(err);","        } else {","            return callback(null, users);","        }","    });"]},{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":60,"column":0},"end":{"row":60,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":60,"column":0}},"nl":"\n","lines":["","userSchema.statics.addRoleByName = function (username, roleName, callback) {","    this.getByUsername(username, function (err, user) {","        if (err) {","            return callback(err);","        } else {","            if (user != null) {","                Role.getRoleByName(roleName, function (err, role) {","                    if (err) {","                        return callback(err);","                    } else {","                        if (role !== null) {","                            if (user.Local.Roles.indexOf(role.RoleID) === -1) {","                                user.Local.Roles.push(role.RoleID);","                                user.save();","                            }","                            return callback(null, 201);","                        } else {","                            return callback(null, 404);","                        }","                    }","                });","            } else {","                return callback(null, 404);","            }","        }","    });"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":54,"column":0},"end":{"row":54,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":54,"column":0}},"nl":"\n","lines":["","","userSchema.statics.getUsersByRoleName = function (roleName, callback) {","    var schema = this;","    Role.getRoleByName(roleName, function (err, role) {","        if (err) {","            return callback(err);","        } else {","            if (role !== null) {","                schema.find({ 'Local.Roles': role.RoleID }, function (err, users) {","                    if (err) {","                        return callback(err);","                    } else {","                        return callback(null, users);","                    }","                });","            } else {","                return callback(null, []);","            }","        }","    });"]},{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":52,"column":0},"end":{"row":52,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":35,"column":0},"end":{"row":52,"column":0}},"nl":"\n","lines":["    this.getByUsername(username, function (err, user) {","        if (err) {","            return callback(err);","        } else {","            if (user !== null) {","                Role.getRolesByID(user.Local.Roles, function (err, roles) {","                    if (err) {","                        return callback(err);","                    } else {","                        return callback(null, roles);","                    }","                });","            } else {","                return callback(null, []);","            }","        }","    });"]},{"action":"removeText","range":{"start":{"row":34,"column":19},"end":{"row":34,"column":75}},"text":"getUserRolesByUsername = function (username, callback) {"},{"action":"removeText","range":{"start":{"row":34,"column":19},"end":{"row":35,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":18},"end":{"row":34,"column":19}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":17},"end":{"row":34,"column":18}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":16},"end":{"row":34,"column":17}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":15},"end":{"row":34,"column":16}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":14},"end":{"row":34,"column":15}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":13},"end":{"row":34,"column":14}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":12},"end":{"row":34,"column":13}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":11},"end":{"row":34,"column":12}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":10},"end":{"row":34,"column":11}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":9},"end":{"row":34,"column":10}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":8},"end":{"row":34,"column":9}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":7},"end":{"row":34,"column":8}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":6},"end":{"row":34,"column":7}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":5},"end":{"row":34,"column":6}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":4},"end":{"row":34,"column":5}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":3},"end":{"row":34,"column":4}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":2},"end":{"row":34,"column":3}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":1},"end":{"row":34,"column":2}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":0},"end":{"row":34,"column":1}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":34,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":58,"column":0},"end":{"row":58,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":35,"column":0},"end":{"row":58,"column":0}},"nl":"\n","lines":["    this.getByUsername(username, function (err, user) {","        if (err) {","            return callback(err);","        } else {","            if (user !== null) {","                Role.getRolesByID(user.Local.Roles, function (err, roles) {","                    if (err) {","                        return callback(err);","                    } else {","                        var inRole = false;","                        roles.forEach(function (role, index) {","                            if (role.RoleName === roleName) {","                                inRole = true;","                            }","                        });","                        return callback(null, inRole);","                    }","                });","            } else {","                return callback(null, false);","            }","        }","    });"]},{"action":"removeText","range":{"start":{"row":34,"column":19},"end":{"row":34,"column":71}},"text":"isInRole = function (username, roleName, callback) {"},{"action":"removeText","range":{"start":{"row":34,"column":19},"end":{"row":35,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":18},"end":{"row":34,"column":19}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":17},"end":{"row":34,"column":18}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":16},"end":{"row":34,"column":17}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":15},"end":{"row":34,"column":16}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":14},"end":{"row":34,"column":15}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":13},"end":{"row":34,"column":14}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":12},"end":{"row":34,"column":13}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":11},"end":{"row":34,"column":12}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":10},"end":{"row":34,"column":11}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":9},"end":{"row":34,"column":10}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":8},"end":{"row":34,"column":9}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":7},"end":{"row":34,"column":8}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":6},"end":{"row":34,"column":7}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":5},"end":{"row":34,"column":6}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":4},"end":{"row":34,"column":5}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":3},"end":{"row":34,"column":4}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":2},"end":{"row":34,"column":3}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":1},"end":{"row":34,"column":2}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":0},"end":{"row":34,"column":1}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":34,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":62,"column":0},"end":{"row":62,"column":7}},"text":"    });"},{"action":"removeLines","range":{"start":{"row":35,"column":0},"end":{"row":62,"column":0}},"nl":"\n","lines":["    this.getByUsername(username, function (err, user) {","        if (err) {","            return callback(err);","        } else {","            if (user !== null) {","                Role.getRoleByName(roleName, function (err, role) {","                    if (err) {","                        return callback(err);","                    } else {","                        if (user.Local.Roles.indexOf(role.RoleID) > -1) {","                            user.Local.Roles.splice(user.Local.Roles.indexOf(role.RoleID), 1);","                            user.save(function (err) {","                                if (err) {","                                    return callback(err);","                                } else {","                                    return callback(null, 200);","                                }","                            });","                        } else {","                            return callback(null, 404);","                        }","                    }","                });","            } else {","                return callback(null, 404);","            }","        }"]},{"action":"removeText","range":{"start":{"row":34,"column":19},"end":{"row":34,"column":81}},"text":"removeUserFromRole = function (username, roleName, callback) {"},{"action":"removeText","range":{"start":{"row":34,"column":19},"end":{"row":35,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":18},"end":{"row":34,"column":19}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":17},"end":{"row":34,"column":18}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":16},"end":{"row":34,"column":17}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":15},"end":{"row":34,"column":16}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":14},"end":{"row":34,"column":15}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":13},"end":{"row":34,"column":14}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":34,"column":12},"end":{"row":34,"column":13}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":35,"column":0},"end":{"row":35,"column":2}},"text":"};"},{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":35,"column":0}},"nl":"\n","lines":["","userSchema.s"]},{"action":"removeText","range":{"start":{"row":32,"column":2},"end":{"row":33,"column":0}},"text":"\n"}]}]]},"ace":{"folds":[],"scrolltop":272,"scrollleft":0,"selection":{"start":{"row":32,"column":2},"end":{"row":32,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":17,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1413513269298,"hash":"6999f11c1f26b7741e37795fc4e66fd93a2a1166"}